name: contribs-animated
on:
  schedule:
    - cron: "0 0 * * *"   # atualiza 1x por dia
  workflow_dispatch:

permissions:
  contents: write

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repo
        uses: actions/checkout@v4

      - name: Setup Node
        uses: actions/setup-node@v4
        with:
          node-version: 20

      - name: Generate animated contributions SVG
        run: |
          mkdir -p dist
          cat > dist/contributions-animated.svg <<'EOF'
          <!-- Animated contributions heatmap (no snake) -->
          <!-- NOTE: Este SVG consulta seu calendário via <image> embedido do GitHub
               e aplica uma animação de máscara "onda" sobre a grade.
               É visual; não executa JS. -->
          <svg xmlns="http://www.w3.org/2000/svg" width="880" height="200" viewBox="0 0 880 200">
            <defs>
              <!-- Máscara com uma faixa que se move na horizontal -->
              <linearGradient id="g" x1="0%" y1="0%" x2="100%" y2="0%">
                <stop offset="0%"   stop-color="white" stop-opacity="0"/>
                <stop offset="45%"  stop-color="white" stop-opacity="1"/>
                <stop offset="55%"  stop-color="white" stop-opacity="1"/>
                <stop offset="100%" stop-color="white" stop-opacity="0"/>
              </linearGradient>

              <mask id="sweep">
                <rect x="-880" y="0" width="2640" height="200" fill="url(#g)">
                  <animate attributeName="x" from="-880" to="0" dur="6s" repeatCount="indefinite"/>
                </rect>
              </mask>

              <!-- Leve pulso global -->
              <filter id="glow">
                <feGaussianBlur stdDeviation="1.5" result="b"/>
                <feMerge>
                  <feMergeNode in="b"/>
                  <feMergeNode in="SourceGraphic"/>
                </feMerge>
              </filter>
            </defs>

            <!-- Fundo -->
            <rect width="100%" height="100%" fill="#0d1117"/>

            <!-- Captura do seu heatmap de contribuições (tema escuro) -->
            <image
              x="0" y="0" width="880" height="200"
              href="https://ghchart.rshah.org/204/{$USER}"
              opacity="0"
            />

            <!-- Usa o gráfico oficial com o resumo —
                 Truque: incorporamos o SVG do seu perfil (contrib calendar)
                 via GitHub badges de terceiros estáveis -->
            <foreignObject x="0" y="0" width="880" height="200" mask="url(#sweep)" filter="url(#glow)">
              <body xmlns="http://www.w3.org/1999/xhtml">
                <img
                  src="https://ghchart.rshah.org/204/brnofreire"
                  width="880" height="200"
                  style="display:block;border-radius:6px;"
                  alt="Contributions heatmap"
                />
              </body>
            </foreignObject>

            <!-- Título opcional -->
            <text x="16" y="28" fill="#c9d1d9" font-size="16" font-family="ui-sans-serif, system-ui">Contribuições de @brnofreire (animadas)</text>
          </svg>
          EOF

      - name: Commit & push
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "41898282+github-actions[bot]@users.noreply.github.com"
          git add dist/contributions-animated.svg
          git commit -m "build: animated contributions svg"
          git push
